%!TEX root = ../main.tex
% vim:nospell

\RequirePackage{shellesc} % unified shell-escape interface
\RequirePackage[debrief]{silence}
\RequirePackage[l2tabu, orthodox]{nag}
\RequirePackage{xstring}
\StrBetween{\luatexbanner}{\detokenize{n }}{\detokenize{.0 (}}[\luatexversionused] % obtain luatex version used
\providecommand{\pdfxopts}{a-3b,pdf17} % may use options such as a-1a. a-1b
\immediate\write18{rm \jobname.xmpdata} % comment for non-*nix systems
\begin{filecontents*}{\jobname.xmpdata}
    \input{Preamble/metadata}
\end{filecontents*}

\PassOptionsToPackage{table}{xcolor}      % necessitated by the pdfx package
\PassOptionsToPackage{luatex}{pdflscape}
\PassOptionsToPackage{pdfa}{hyperref}

% Pass options to standard packages whenever they get loaded
\PassOptionsToPackage{title,titletoc}{appendix}
\PassOptionsToPackage{makeroom}{cancel}
\PassOptionsToPackage{backend=biber, style=numeric-comp, sorting=none, citestyle=numeric-comp, maxbibnames=50, url=true, doi=true, eprint=false, backref=true,backrefstyle=three}{biblatex}
\PassOptionsToPackage{margin=10pt,font=small,labelfont={bf},labelsep=quad}{caption}
\PassOptionsToPackage{normal}{engord}
\PassOptionsToPackage{inline}{enumitem}
\PassOptionsToPackage{draft}{fixme}
\PassOptionsToPackage{bottom}{footmisc}
\PassOptionsToPackage{luatex,paper=a4paper,hmarginratio=1:1, vmarginratio=1:1, scale=0.75}{geometry}
\PassOptionsToPackage{local,mark}{gitinfo2}
\PassOptionsToPackage{frac,vfrac,multskip}{mathfixs}
\PassOptionsToPackage{section}{placeins}
\PassOptionsToPackage{separate-uncertainty = true,multi-part-units=single,detect-all}{siunitx}
\PassOptionsToPackage{nottoc}{tocbibind}
\PassOptionsToPackage{normalem}{ulem}
\PassOptionsToPackage{no-math,quiet}{fontspec}
\PassOptionsToPackage{warnings-off={mathtools-colon}}{unicode-math}
\PassOptionsToPackage{british}{babel}
\PassOptionsToPackage{final,activate={true,nocompatibility},factor=1100,stretch=10,shrink=10,babel=true}{microtype}
\PassOptionsToPackage{british}{selnolig}
\PassOptionsToPackage{newfloat=true}{minted}
\PassOptionsToPackage{minted,most}{tcolorbox}
\PassOptionsToPackage{modifier={by-nc-nd}}{doclicense}

\documentclass[12pt,a4paper,oneside,openright]{book} % using the book document class

%%%%%%%%%% \usepackage list here %%%%%%%%%%

\usepackage{algpseudocode}  % http://ctan.org/pkg/algorithmicx
\usepackage{bigints}
\usepackage{cancel}
\usepackage{pdfpages}
\usepackage{tabstackengine}

\input{Preamble/standard_packages} % a bit specific to luatex; including biblatex

\usepackage{fontspec} % after graphicx ; no-math option so that math-handling is left to unicode-math; silent to completely suppress all warnings (even in log file)
\usepackage{unicode-math}

\input{Preamble/font_selection.tex}

\usepackage{babel} % with british, we get OUP hyphenation material for free
\usepackage{microtype} % if using option babel=true, babel must be loaded before microtype
\usepackage{selnolig} % if using babel, this package should go after loading babel

% Loading order is important here https://tex.stackexchange.com/questions/435529/correct-loading-order-of-package-newfloat-along-with-hyperref-and-algorithmic-pa/435597#435597
\usepackage{float}

% \usepackage[draft=true,newfloat=true]{minted}
% \usepackage[minted]{tcolorbox}
\usepackage{minted}
\usepackage{tcolorbox}

\usepackage{csquotes} % The fvextra package is loaded by minted, so you should load minted before csquotes
\usepackage{doclicense} % depends on csquotes

\usepackage{chemformula} % uses tikz arrows

% \addbibresource{chapters/backmatter/thesis_refs.bib}
\ShellEscape{biber --tool chapters/backmatter/thesis_refs.bib} % deduplicate bibtex entries
\addbibresource{chapters/backmatter/thesis_refs_bibertool.bib}
% \setupbibentry{chapters/backmatter/thesis_refs.bib}

\input{Preamble/hyperref_related} % hyperref, glossaries etc.

\input{Preamble/custom_battery_specific_cmds}
\input{Preamble/custom_colors}
\input{Preamble/custom_genpurpose_cmds}
\input{Preamble/custom_cmds_pkg_minted}
\input{Preamble/custom_cmds_pkg_cancel} % uses a predefined color
\input{Preamble/custom_cmds_algtypesetting} % for typesetting of algorithms
\input{Preamble/custom_cmds_graphics}
\input{Preamble/custom_cmds_pkg_enumitem}
\input{Preamble/custom_cmds_pkg_fancyheader}
\input{Preamble/custom_cmds_pkg_siunitx}
\input{Preamble/custom_cmds_pkg_fxnote}
\input{Preamble/custom_cmds_pkg_diffcoeff}
\input{Preamble/custom_cmds_tabularmaterial}
\input{Preamble/custom_cmds_pkg_cleveref}
\input{Preamble/custom_cmds_pkg_gitinfo2}
\input{Preamble/custom_cmds_pkg_glossaries.tex}

% https://tex.stackexchange.com/questions/50830/do-i-have-to-care-about-bad-boxes/50850#50850
\tolerance=1414
\hbadness=1414
\emergencystretch=1.5em
\hfuzz=0.5pt
\vfuzz=\hfuzz
\raggedbottom
\hyphenpenalty=750
\frenchspacing
\binoppenalty=1000 % default 700
\relpenalty=800     % default 500
\interfootnotelinepenalty=10000
% \clubpenalty=10000
% \widowpenalty=10000

% \usepackage[draft,hyphenation,lastparline,nosingleletter,homeoarchy,rivers]{impnattypo}
\usepackage[hyphenation,lastparline,nosingleletter]{impnattypo}
\usepackage[defaultlines=2,all]{nowidow}


%%%%%%%%%% glossaries-related stuff %%%%%%%%%%%%%%%%%%%%
\makeglossaries % must be before starting to define any entries for the glossary. And, all glossary definitions (such as for symbols and any other custom glossaries) must come before this.
% no hyperlink on first use for entries with category=acronym
\glssetcategoryattribute{acronym}{nohyperfirst}{true} % https://tex.stackexchange.com/questions/434160/line-break-long-glossaries-entry-when-using-hyperref-and-latex-dvips-ps2pdf
\setabbreviationstyle[acronym]{long-short} % applicable only for glossaries-extra.sty
\input{chapters/frontmatter/acronyms}

