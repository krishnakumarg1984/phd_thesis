% -*- root: ../main.tex -*-
%!TEX root = ../main.tex
% this file is called up by main.tex
% content in this file will be fed into the main document
% vim:textwidth=80 fo=cqt

%level followed %by section, subsection


% ----------------------- paths to graphics ------------------------

% change according to folder and file names
\graphicspath{{4/figures/}}
% ----------------------- contents from here ------------------------

Battery modellers face the classic  conundrum of conjuring physics-based battery
models that remain  amenable for control applications.  Firstly, the contrasting
nature of this modelling objective is presented. Secondly, prior attempts by the
research community to  tackle this issue is briefly examined.  A suitable family
of models  from the broad  category of reduced-order  models is identified  as a
promising  candidate  for implementation  in  controls  applications. Next,  the
drawbacks of this family of models is  discussed in detail. The state of the art
implementation for tackling these drawbacks  is presented and their inadequacies
are discussed.

\todo{write the chapter first. Come back to summarize this.}

The following efforts/trials were done (failures)
\begin{itemize}
    \item first attempt
    \item second attempt
\end{itemize}
The following successes were achieved.
\begin{itemize}
    \item first attempt
    \item second attempt
\end{itemize}

At the  end of this  chapter, we have a  control oriented reduced  order battery
model amenable for use in real-time applications for SOC, SOH etc.\ estimations.

Control-Oriented  models can  be considered  synonymous with  the term  `Reduced
Order Models'. This is because the complexity of physics-based models inherently
necessitates the  use of a low  order model. In  this thesis, the two  terms are
used interchangeably.

\section{A new classification scheme for control-oriented models}

Jokar~\etal~\cite{Jokar2016}  provide  a  comprehensive review  of  the  various
categories of  reduced order  physics based battery  models. However,  a notable
omission  in~\cite{Jokar2016}  is  that  it  does not  aim  to  classify  models
based  on  time-vs-frequency  domains.  Fan~\etal{}~\cite{Fan2015}  performed  a
similar  review of  reduced  order  battery models,  but  only  provide a  brief
comparative overview  of models derived  and implemented in these  dual domains.
Unlike~\cite{Jokar2016}, this review did not  aim to provide a classification of
various  reduced  order  models,  but  instead  emphasises  on  a  broad  survey
of  relevant  methodologies and  tools  towards  obtaining such  models.  Hence,
neither~\cite{Jokar2016}  nor~\cite{Fan2015} provide  specific  emphasis on  the
rubrics  and implication  of the  choice of  modelling in  either of  these dual
domains. Although in principle, the transformation between them follows standard
mathematical  practices,~\todo{citation(s) needed?}  availability of  models for
final implementation  in the time domain  aids immediate uptake by  industry for
adoption  in online  \gls{bms}s. Treatment  of  reduced order  models from  this
aspect  is  so germane  to  the  central  hypothesis of  this  chapter,\todo{can
a  simple  time-domain  model do  the  job?}  that  the  author of  this  thesis
feels  compelled  to undertake  a  simpler  classification exercise  within  the
context  of  suitability for  online  implementation.  In this  discussion,  the
various  modelling  methodologies and  the  resulting  models  are viewed  as  a
continuum  and hence  this thesis  discusses  them from  a unified  perspective.
Furthermore,  there  is  also  a  need to  highlight  the  salient  works  among
the  more recent  advances and  extensions to  then-prevailing models  published
since~\cite{Jokar2016}  and~\cite{Fan2015}.  Hence,  the specialised  review  of
reduced order modelling literature covered in this section intends to supplement
---  not supplant  --- the  breadth of  modelling art  covered between  them. In
particular,  care  has been  taken  to  minimize  repetition of  background  art
analysed in these aforementioned review articles, ensuring that only a subset of
prior research  that is  pertinent to illustrate  the new  classification scheme
introduced here shall be discussed.

Physics-based control-oriented Models  can be classified as belonging  to one of
the following categories.\todo{just enumerate my classification in-line here} It
is important to distinguish between models that are derived directly in the time
domain versus  those that are  derived first in  the frequency domain  and later
converted to time domain.\todo{Need to write this better}

In  principle,  a  modelling  method  that  yields  a  time-domain  mathematical
description of physical  phenomena that is lower in  computational complexity by
an arbitrary magnitude  than the original \gls{dfn} model can  be considered for
further investigation. In  the absence of a quantitative definition  of what can
be considered as a  true reduced order model, the number  of candidate family of
models  to  consider  is  overwhelmingly large\todo{is  it  appropriate  to  use
such  language?}. In  practice, the  constraints and  challenges imposed  by the
scope  of this  work, \viz{}  suitability for  real-time implementation,  limits
the  choice  of  candidate  modelling families.  For  instance,  models  relying
primarily on  classical finite  difference~\cite{Smith2006} and  Galerkin Finite
Element~\cite{Dao2012} methods for transformation and  order reduction of one or
more field variables  of the \gls{dfn} model are immediately  excluded, owing to
the impracticability of implementing  them in a resource-constrained environment
such as an embedded \gls{bms} controller.

Owing to  the low entry-barrier for  adoption in a real-time  controller logging
data samples at specific time intervals, this thesis focusses on models that are
cast in a form for final implementation  in the time domain. This choice implies
the exclusion of  those models that are derived and  implemented entirely in the
frequency domain.  For the interested reader  who wishes to peruse  the sizeable
literature in  this field, the  discussion here  briefly alludes to  the salient
frequency domain modelling techniques.

The     transfer     function     oriented    Padé     approximation     method
for    low    order    physics-based     battery    modelling    pioneered    by
Forman~\etal{}~\cite{Forman2011a}    has   gained    widespread   adoption    in
the    areas   of    cell   design~\cite{Marcicki2013},    charging   trajectory
optimisation~\cite{Bashash2010},  controller  design~\cite{Perez2015} and  state
estimation~\cite{Marcicki2013,Moura2012,Bartlett2015}.   Although   Prasad   and
Rahn~\cite{Prasad2013} present  an online identification  of a subset  of ageing
parameters using a Padé model and a recursive least squares algorithm, specific
implementation details such as the transformation of the Padé reduced impedance
to  discrete-time  difference  equations  was not  provided.  Padé  models  are
typically limited  to offline  applications owing  to the  aggressive trade-offs
required in the approximation order to maintain accuracy. Those models truncated
to  very low  Padé  order exhibit  poor  fidelity and  perform  no better  than
classical  equivalent circuit  models,  although recent  research attempts  have
focussed  to  mitigate  this  drawback~\cite{Yuan2017a,Yuan2017}.\todo{Should  I
discuss how?}

Smith~\etal{}~\cite{Smith2007}  pioneered   a  semi-hybrid   modelling  approach
to  reduced  order  modelling  and  obtained closed  form  expressions  for  all
electrochemical field variables  in the frequency domain  except for electrolyte
concentration and  potential (which were  solved separately using  the classical
finite difference discretization method). To the author's knowledge, this is the
earliest  published  instance  wherein  all  the  dynamics  of  the  full  order
model were  completely retained  in the frequency  domain. This  was facilitated
through the  use of transcendental transfer  functions that helped to  avoid the
accuracy  degradation  brought about  by  truncation  techniques such  as  Padé
approximation. A composite impedance model  was obtained that was then converted
to  a \engordnumber{12}  order state  space model  through residue  grouping and
truncation techniques.  Thus, in the viewpoint  of the author of  this thesis, a
complete workflow of a hybrid modelling  workflow has been presented. This model
was capable of  predicting the battery terminal  voltage within \SI{1}{\percent}
of a full-order \gls{dfn} model. This frequency domain impedance-based model was
derived for the  frequency range of interest  from \SIrange{0}{10}{\hertz}. This
modelling effort  was the first of  its kind to provide  a physics-based battery
model for implementation in the classical state-space formulation
\begin{equation}\label{eq:statespace}
    \begin{aligned}
        \dot{x} &= Ax + Bu \\
        y &= Cx + Du
    \end{aligned}
\end{equation}

that  is amenable  for  controller design  and  further system-level  simulation
studies \eg{} as a component in a (hybrid) electric vehicle drivetrain.

The requirement of a relatively large  number of state variables to describe the
system dynamics dilutes the effectiveness of state estimation algorithms. In the
classical  isothermal implementation  of this  model, with  only output  voltage
being  the  only measured  quantity,  the  observablity  of the  model  degrades
significantly. Although Smith~\etal{} performed  an observablity analysis of the
model in  a noise-free context,  the presence  of process noise  (via unmodelled
electrochemical phenomena and parameter uncertainties) coupled with sensor noise
makes this model  unattractive for state estimation tasks in  an online embedded
application.

Several attempts have been undertaken to  improve and extend the ideas pioneered
in  Smith~\etal{}~\cite{Smith2007}.  Lee~\etal{}~addressed  a  critical  missing
aspect  of~\cite{Smith2007}, \viz{}  the derivation  of transcendental  transfer
functions  for  both electrolyte  concentration  and  potential. These  transfer
functions were  obtained by  using a Sturm-Louiville  approach by  retaining the
first five modes of the  eigenfunction expansion, as detailed in~\cite{Lee2012}.
To the  author's best knowledge,  this is the  first published work  wherein all
electrochemical  field variables  of  the \gls{dfn}  model  were considered  for
inclusion in  a deterministic model  order reduction procedure  whilst remaining
entirely within the frequency domain.

Obtaining  closed form  expressions for  the electrolyte  variables achieved  in
Lee~\etal{} also has an important computational implication. With these capstone
derivations serving to completing the model description in the frequency domain,
all  electrochemical  variables of  the  \gls{dfn}  model  could now  be  solved
independently at any  desired spatial location, \eg{} at  the current collectors
and separator  interfaces. Until  this point,  the state of  the art  in reduced
order  modelling invariably  necessitated  the solution  of all  electrochemical
quantities at  multiple node locations along  the thickness of each  cell layer,
placing a computational burden. This is  a significant deterrent to the adoption
of such  models if the intended  purpose of the  model is to simply  predict the
cell's terminal voltage.  Furthermore, among methods that retain  the full order
Fickian diffusion  for describing solid  phase diffusion within  each electrode,
this further necessitates discretisation also along the radial direction thereby
increasing  the overall  number  of  nodes by  an  order  of magnitude  directly
impacting the computational efficiency of such models.

The  impact of  high node  densities on  the computational  requirements of  the
original  \gls{p2d}  model have  led  researchers  to adopt  various  mitigation
strategies to  tackle this issue. In  contrast to the pure  frequency domain and
the  semi-hybrid/hybrid approaches  discussed thus  far, these  attempts aim  to
provided a simpler computational mesh,  whilst retaining high fidelity and hence
can be  classified as  time domain methods.  It should be  noted that  high node
densities are  mainly required near the  surface of the spherical  particles for
the  pseudo  \engordnumber{2} dimension,  whilst  such  clustering of  nodes  is
desirable near  the separator and  current collector interfaces along  the axial
dimension.\todo{need to  define `axial'  at the  start of  the thesis}.  Thus, a
large number  of model  order reduction  strategies in the  time domain  seek to
adopt  non-uniform node  spacing  towards lowering  the aforesaid  computational
issues.

Bizeray~\etal{}~\cite{Bizeray2015}         performed         a         Chebyshev
discretisation~\cite{Trefethen2000}  of   the  entire   \gls{p2d}  model   on  a
global  scale,  \ie{}  along  both   the  axial  and  radial  directions.  Thus,
a  spectral  scheme,   beyond  the  algebraic  orders   of  accuracy  achievable
with  classical  Finite  Difference,  Finite Element  or  Finite  Volume  Scheme
could  be  applied.  The reduced  number  of  nodes  as  well as  their  desired
clustering  at  the  aforementioned  spatial  locations  ensures  a  significant
lowering  of computational  burdens of  simulating a  physics-based cell  model.
Gopalakrishnan~\etal{}~\cite{Gopalakrishnan2018} undertook a  hybrid approach by
retaining a standard finite volume discretisation in the axial domain equations,
whilst adopting the  Chebyshev discretisation only for the  critical solid phase
diffusion component in the radial direction. Albeit in time domain, the standard
\gls{p2d} equations, their boundary conditions and corresponding field variables
are  mathematically transformed  to the  Chebyshev space  within which  they are
solved.  The details  of this  transformation is  presented in  \Cref{sec:hybrid
fv-spectral} in  \Cref{ch:chapter2} for  the case  of the  solid-phase diffusion
equation.  Finally,   these  solved  quantities   are  converted  back   to  the
physical  space through  a corresponding  inverse transformation.  Although this
bi-directional transformation is algebraic in nature, the requirement of running
a spatially resolved model coupled with  such overheads render these category of
time domain models unsuitable for online implementation. In this context, the
contribution of Lee~\etal{}, \ie{} the ability to solve for any electrochemical
variable at an arbitrary spatial location by completely eliminating the need for
spatial discretisation assumes special significance.

Furthermore,  Lee~\etal{}   also  devised  the  \gls{dra},   a  novel  algorithm
to  systematically  transform  all  transcendental  transfer  functions  to  the
time-domain to  obtain the standard state-space  model given by~\cite{Lee2012a}.
The  author of  this thesis  considers  the formulation  of the  \gls{dra} as  a
breakthrough  contribution  that  has  helped  in  bringing  a  physics-informed
time-domain  model  a  step  closer  to  online  implementation  without  having
to  resort to  forming  a  lumped impedance  and  then  truncating it  suitably.
Lee~\etal{}~\cite{Lee2014}  then  extended  this  work  for  a  wider  range  of
operation  across  various  \gls{soc},  temperature and  C-rates.  Although  the
final  state  space  model  is  simple to  implement,  the  classical  \gls{dra}
scheme   proposed  by   Lee~\etal{}   suffers   from  significant   computational
bottlenecks  in   forming  the  required   block  Hankel  matrices   during  the
model-derivation phase.  A memory-efficient version of  the \gls{dra} exploiting
the   skew-symmetric   structure  of   these   Hankel   matrices  was   proposed
in  Gopalakrishnan~\etal{}~\cite{Gopalakrishnan2017}  resulting  in  drastically
reduced memory and processor requirements.

In both the original  as well as the improved \gls{dra},  the computation of the
EigenFunction modal expansion of electrolyte concentration transfer function was
slow.  A less  severe disadvantage  with the  transcendental transfer  functions
associated with the electrolyte concentration was that their derivation entailed
mathematically cumbersome  symbolic manipulations  that dictated  the need  of a
capable \gls{cas} package.  Albeit from a standalone  viewpoint this requirement
does  not  seem to  be  critical,  the Ho-Kalman  algorithm  that  forms a  core
component  of the  \gls{dra}  schemes  is steeped  in  numerical linear  algebra
routines. Furthermore, for facilitating  state estimator and controller designs,
it is  convenient to implement  the resultant  state-space model in  a classical
numerical  computation environment  such as  \textsc{MATLAB}. Taking  these into
consideration,  Rodriguez~\etal{}~\cite{Rodriguez2017}  introduced a  simplified
computation of the  electrolyte concentration transfer function  by applying the
variation of  parameters (VOP) scheme.  With this final improvement,  the hybrid
scheme by Lee~\etal{}  can be considered feature-complete  with low computational
requirements during both model derivation and implementation phase.

A  key  drawback  of  the  transcendental  transfer  function  approach  is  the
requirement for  linearisation at  a specific \gls{soc}.  This implies  that the
entries in  the matrices of the  state space model depends  on the linearisation
point.  In all  the  published  works employing  this  approach, these  transfer
functions were obtained  by linearising the \gls{p2d} equations  at an operating
point of  \SI{50}{\percent} \gls{soc}. The requirement  of linearisation renders
the  model usable  only  in  a narrow  range  of  \gls{soc}s. Furthermore,  this
adversely affects the usability of the model for state estimation tasks, wherein
the  \gls{soc} is  in  fact the  unknown  quantity to  be  estimated. To  extend
the  model's range  of  validity, Lee~\etal{}~\cite{Lee2014}  proposed a  simple
model-blending  approach by  interpolating between  several pre-computed  linear
models  at  different  \gls{soc}  and  temperature  combinations.  To  guarantee
robustness during cross-over, a naive approach  is to incorporate a large number
of break-points  in the look-up  table. Since the  model is intended  for online
operation,  such  an approach  would  entail  significant requirements  of  both
volatile  and  non-volatile memory.  An  alternative  approach  is to  retain  a
coarse  break-point table;  but  this  demands careful  tuning  of the  blending
parameters  and  gain values,  an  in-depth  treatment  of  which has  not  been
given  in  Lee~\etal~\cite{Lee2014}.  Furthermore, employing  these  interpolated
matrices---whose entries  are obtained from  matrices at various  \gls{soc}s and
temperature---for state-estimation  creates a subtle cyclic  loop. The stability
of  this feedback  loop introduced  by this  methodology has  not been  analysed
and  proven in  literature.  This  renders the  idea  of state-estimation  using
such  run-time  interpolated models  questionable.  The  author of  this  thesis
hypothesises  that  any perceivable  drawbacks  such  as non-smooth  changes  in
\gls{soc}  estimates could  be mitigated  by using  smoothing filters  and other
ad-hoc  apparatus  estimations. However,  there  exist  no published  work  that
discusses these engineering  aspects. Coupled with the absence  of a theoretical
analysis of  loop stability, these models  are not deemed as  not being suitable
for immediate  adoption by  industry, at least  until these  aforementioned gaps
have been addressed satisfactorily.

Physics-inspired equivalent circuit models~\cite{Merla2018,Prasad2014,Zhang2017}
are  a  class  of  hybrid  models that  have  rapidly  gained  prominence  since
the publication  of~\cite{Jokar2016} and~\cite{Fan2015}.  The derivation  of the
relevant model  equations is performed  in the frequency domain.  This frequency
domain representation  is then converted  to a form suitable  for implementation
as  an  equivalent circuit.  Prasad  and  Rahn~\cite{Prasad2014} extended  their
Padé order  reduced model first  presented in~\cite{Prasad2013} to  convert the
impedance model into standard equivalent circuits. A key point to be highlighted
is  that  these  family of  models  do  not  necessarily  strive to  retain  the
classical  Randles  structure~\cite{Randles1947}  for their  equivalent  circuit
representation. Instead, the values of the electrical circuit components such as
series  resistance  and  equivalent  capacitance are  obtained  through  various
mechanisms \todo{such as EIS measurements  and \ldots}. The biggest advantage of
such models is that they serve as drop-in replacements to traditional equivalent
circuit  models whilst  still  retaining their  origins  in physical  principles
rather than on empirical curve-fitting.

\Cref{ch:chapter6}  briefly presents  the author's  latest work  and preliminary
results  towards   obtaining  a  similar  physics-informed   equivalent  circuit
model.  This  modelling  effort  is  a   direct  application  of  the  gains  in
computing  efficiency   through  the  application  of   the  improved  \gls{dra}
reported   in   Gopalakrishnan~\etal{}~\cite{Gopalakrishnan2017}  the   detailed
coverage  of  which  is   performed  in~\cref{ch:chapter3}.  This  work  intends
to  address  the hitherto  unexplored  gap  in  impedance modelling,  \ie{}  the
absence  of  an equivalent  impedance  model  that  accounts for  the  impedance
contribution from all electrochemical quantities  from the \gls{p2d} model. This
physics-informed  impedance  model  can  be extended  to  fit  parameter  values
of  components  in an  equivalent  circuit  model,  \eg{} through  the  standard
Levenberg-Marquardt~\cite{Levenberg1944, Marquardt1963} non-linear least squares
fitting algorithm.

A common characteristic of all hybrid models  is the lack of physical meaning of
their model parameters. This severely limits the insights offered by such models
into electrochemical phenomena  internal to the cell. The  biggest attraction of
using  physics-based models  is  the possibility  of  predicting phenomena  such
as  cell degradation,  \eg{}  through  computation of  the  solid phase  surface
concentration and potentials in a  vehicular application, since their exact load
profile  cannot be  simulated a-priori.  In this  scenario, a  model capable  of
implying a direct and causal relationship between a group of physical parameters
and internal overpotentials at various  spatial locations within the cell serves
as a  powerful tool in  in-situ lifetime  estimation of batteries.  Although the
circuit  components  of  physics-informed  equivalent  circuit  models  and  the
state-space models discussed here trace their origins to the original parameters
of  the  \gls{dfn} model,  their  final  numerical values  do  not  bear even  a
semblance of  this relationship.

Merla~\etal{}~\cite{Merla2018} introduced  an equivalent circuit model  that can
be  parameterised by  attempting a  systematic  decoupling of  the kinetics  and
diffusion at  both electrodes  and the  electrolyte. Although  these interacting
phenomena can be complex to resolve  over all length and time-scales, acceptable
trade-offs in  accuracy was  demonstrated to be  achievable from  a system-level
simulation perspective. A  drawback of such models is that  key model parameters
such  as  solid  and  electrolyte   diffusion  coefficients  are  attributed  to
the  two electrodes  through  ad-hoc,  non-verifiable assumptions.  Furthermore,
in~\cite{Merla2018},  notable discrepancies  exist in  the values  of parameters
such as  electrolyte conductivity (obtained through  calculations from \gls{eis}
measurements) to that typically reported in literature.

It must be acknowledged that presently  there exists no modelling candidate that
provides  all desirable  characteristics of  a reduced  order model.\todo{Should
have enumerated in the beginning  \ldots graphically (spider drawing)}. However,
it is  strongly desirable  that the  majority of the  final model  values retain
their physical meaning, yielding system  engineers and cell designers alike with
a  direct  and  causal  relationship  between groups  of  parameters  and  their
influence  on  the  cell's  operational performance.  Since  this  thesis  seeks
to  provide a  readily  usable  model that  satisfies  all  \todo{give a  number
here} criterion  for online implementation  from \todo{cite figure},  the author
concludes  that  at present,  the  benefits  offered  by  hybrid models  do  not
decisively outweigh this drawback.

\todo{introduce PP2D now}

The drawback of all physics-based models  discussed thus far is that they entail
extensive parametrisation  efforts \todo{at  the end,  count and  substitute the
canonical number  of parameters here}  to render  them useful for  any practical
application. The difficulties associated with such parametrisation, coupled with
inherent  uncertainties  in  the  obtained  parameter values  act  as  a  strong
deterrent to  stakeholders outside  academia to  adopt physics-based  models for
online implementation in a \gls{bms}.

\todo{introduce SPM now}

\todo{Tikz picture  here, showing a nice  layout of various models  according to
the new classification scheme. Show spider web drawing?}


\todo{Where does this  paragraph go? End of this section/end  of chapter or even
last  chapter?} The  identification of  individual parameters  of the  \gls{dfn}
model  remains a  key  area in  battery modelling  that  remains only  partially
explored. Nevertheless, this effort is critical  to ensure rapid adoption of any
physics-based model and  sophisticated control algorithms. The state  of the art
in this area, the challenges involved  and current efforts in this direction are
explored in~\cref{ch:chapter6}.  Although sensitivity analysis of  the \gls{dfn}
parameters has been performed in  literature, \todo{citation here} the extent to
which  parameter uncertainties  influence the  numerical  values in  the $A,  B,
C$  and  $D$  matrices  of~\Cref{eq:statespace} has  not  yet  been  attempted.
In  continuation of  this  research  aspect, the  order  of  magnitude shift  in
eigen/singular values of  the relevant system matrix also need  to be quantified
to  enable an  informed  choice about  stability of  such  models for  real-time
implementations.


% \begin{figure}[htb]
% \begin{algorithmic}[1]

% \Procedure{SUM}{ $\{x\}$}

% \State $y\gets0$
% \For{$i \gets 1 : N^{x}$} \Comment{Time series $\{x\}$ has length $N^{x}$}
%    \State $y\gets y+x(i)$ \Comment{Summing up.}
% \EndFor

% \State \textbf{return}  $y$
% \EndProcedure
% \end{algorithmic}
% \caption[Implementation of a algorithm for calculating a sum.]{Implementation of a algorithm for calculating a sum.}
% \label{fig:algorithm1}
% \end{figure}




% ---------------------------------------------------------------------------
%: ----------------------- end of thesis sub-document ------------------------
% ---------------------------------------------------------------------------

